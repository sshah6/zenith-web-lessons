<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <title>Orders</title>
    <link rel="shortcut icon" href="about:blank" />
    <style>
      .card {
        background-color: cornsilk;
        border: 2px solid black;
        margin-bottom: 5px;
        padding: 10px;
      }
      dt {
        font-weight: bold;
      }
      dd {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
    <h1>Current Orders</h1>
    <div id="orders">
      <!-- This HTML should be dynamically generated by JS -->
      <article class="card">
        <h3>Order #x</h3>
        <dl>
          <dt>Item Ordered</dt>
          <dd>Such and such item</dd>
          <dt>Ordered by</dt>
          <dd>Ordered by such and such</dd>
        </dl>
      </article>
    </div>
    <button id="update">Update w/Ajax</button>
    <script
      src="https://code.jquery.com/jquery-2.2.4.min.js"
      integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
      crossorigin="anonymous"
    ></script>
    <script>
      $(document).ready(function () {
        "use strict";
        /*
        1. make a request for the data (orders.json)
        2. loop through the data and build an HTML string to create the HTML to display the data
        3. update the DOM with the new HTML
     */

        /**
         * Creates an HTML string based on a JSON array of orders
         * @param orders
         */

        /*
        {
            "orderNumber": 1,
            "itemOrdered": "Small Sweater",
            "orderedBy": "Johnny Be Good"
        }
     */

        //##### This function works as well, but the one thats working right now is a better way to approach it.


        //     function createHTML(orders) {
        //     // $.ajax("file.json").done(function (data) {
        //       console.log(orders);

        //       // loop through all the orders and create an HTML string for each order
        //       let html = "";
        //       for (let i = 0; i < orders.length; i++) {
        //         html +=
        //         `<article class="card">
        //             <h3>Order #  ${orders[i].orderNumber} </h3>
        //             <dl>
        //                 <dt>Item Ordered</dt>
        //                     <dd>  ${orders[i].itemOrdered}  </dd>
        //                 <dt>Ordered by</dt>
        //                     <dd> ${orders[i].orderedBy} </dd>
        //             </dl>
        //         </article>`;
        //       }
        //     //   $("#orders").html(html);

        //     // });
        //     return html;
        // }

        function createHTML(orders) {
          // loop through all the orders and create an HTML string for each order
          let html = "";
          for (let i = 0; i < orders.length; i += 1) {
            html +=
              '    <article class="card">\n' +
              "        <h3>Order #" +
              orders[i].orderNumber +
              "</h3>\n" +
              "        <dl>\n" +
              "            <dt>Item Ordered</dt>\n" +
              "            <dd>" +
              orders[i].itemOrdered +
              "</dd>\n" +
              "            <dt>Ordered by</dt>\n" +
              "            <dd>" +
              orders[i].orderedBy +
              "</dd>\n" +
              "        </dl>\n" +
              "    </article>";
          }
          return html;
        }

        /**
         * Triggers a new AJAX request to the orders.json file and re-renders the orders HTML using the createHTML function
         */
        function updatePage() {
          // make request to orders.json
          console.log("Update orders");
          $.get("file.json")
            .done(function (orders) {
              let ordersHTML = createHTML(orders); // create HTML string
              $("#orders").html(ordersHTML); // update the DOM with the new HTML
            })
            .fail(function (jqXhr, status, error) {
              console.log(jqXhr);
              console.log(status);
              console.log(error);
            });
        }
        updatePage();

        // when a user clicks on the update button, refresh the page with the latest order information

        $("#update").on("click", function () {
          updatePage();
        });

        // every 3 seconds, update the orders to show the latest changes
        setInterval(updatePage, 3000);
      });
    </script>
  </body>
</html>
